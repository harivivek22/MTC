<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Swiper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="httpshttps://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Cool Gray & Blue -->
    <!-- Application Structure Plan: The application is structured as a two-view SPA: a 'Feed' for discovery and 'My Lists' for review. This dashboard-like approach separates user tasks, improving usability. The user flow is: Discover on Feed -> Swipe to categorize -> Review in My Lists. This structure was chosen to give purpose to the swipe interaction, allowing users to build their own curated lists and making the experience more engaging and valuable than a simple content-dismissal system. All state is managed in JS and persisted in localStorage. -->
    <!-- Visualization & Content Choices: Report Info: User's video preferences -> Goal: Organize & Synthesize -> Viz/Presentation Method: Two-column lists ('Seen', 'Watch Later') populated with clickable video thumbnails and titles. -> Interaction: Tapping a nav button switches between the feed and list views. Swiping a card in the feed view dynamically adds it to the appropriate list. -> Justification: The lists provide a clear, organized summary of user activity, turning ephemeral interactions into a tangible, personalized collection. This directly addresses the goal of synthesizing information. This is achieved with dynamic HTML generation via vanilla JS, which is efficient for this task. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .video-card {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform-origin: center;
        }
        .seen-label, .later-label {
            position: absolute;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            z-index: 10;
        }
        .seen-label {
            background-color: #22c55e;
            color: white;
        }
        .later-label {
            background-color: #f97316;
            color: white;
        }
        .nav-button.active {
            background-color: #4f46e5;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4 overflow-hidden">

    <div class="w-full max-w-sm h-full flex flex-col">
        <!-- Main Content Area -->
        <main class="flex-grow overflow-hidden flex flex-col">
            <!-- Feed View -->
            <div id="feed-view" class="w-full h-full flex flex-col items-center">
                <div class="mb-4 text-center">
                    <h1 id="video-title" class="text-2xl font-bold text-gray-100">Loading Videos...</h1>
                    <p id="instruction-text" class="text-gray-400">Please wait.</p>
                </div>
                <div class="relative w-full rounded-3xl overflow-hidden shadow-2xl" style="aspect-ratio: 9 / 16;">
                    <div id="video-card" class="video-card relative w-full h-full bg-gray-800 rounded-3xl">
                        <div class="absolute inset-0 bg-cover bg-center rounded-3xl" id="video-thumbnail"></div>
                        <div class="seen-label" id="seen-label">SEEN</div>
                        <div class="later-label" id="later-label">WATCH LATER</div>
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/70 via-black/40 to-transparent">
                        <a id="watch-button" href="#" target="_blank" class="w-full flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 text-lg">
                            Watch Now
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                            </svg>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Lists View -->
            <div id="lists-view" class="hidden w-full h-full flex-col p-2 overflow-y-auto">
                <div class="mb-4">
                    <h2 class="text-2xl font-bold text-gray-100 mb-2">Watch Later</h2>
                    <div id="watch-later-list" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-100 mb-2">Seen</h2>
                    <div id="seen-list" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
                </div>
            </div>
        </main>

        <!-- Navigation -->
        <nav class="w-full mt-4 flex justify-center bg-gray-800 p-2 rounded-full">
            <button id="feed-button" class="nav-button active flex-1 text-center py-2 px-4 rounded-full font-semibold">Feed</button>
            <button id="lists-button" class="nav-button flex-1 text-center py-2 px-4 rounded-full font-semibold">My Lists</button>
        </nav>
    </div>

    <script>
        let allVideoData = [];
        let feedVideoData = [];
        let videoIndex = 0;
        let startX = 0, startY = 0, currentX = 0, currentY = 0;
        let isSwiping = false;

        let seenList = JSON.parse(localStorage.getItem('seenList')) || [];
        let watchLaterList = JSON.parse(localStorage.getItem('watchLaterList')) || [];

        const videoCard = document.getElementById('video-card');
        const videoTitle = document.getElementById('video-title');
        const videoThumbnail = document.getElementById('video-thumbnail');
        const watchButton = document.getElementById('watch-button');
        const seenLabel = document.getElementById('seen-label');
        const laterLabel = document.getElementById('later-label');
        const instructionText = document.getElementById('instruction-text');
        
        const feedView = document.getElementById('feed-view');
        const listsView = document.getElementById('lists-view');
        const feedButton = document.getElementById('feed-button');
        const listsButton = document.getElementById('lists-button');
        const watchLaterListDiv = document.getElementById('watch-later-list');
        const seenListDiv = document.getElementById('seen-list');

        const getYouTubeId = (url) => {
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i;
            const match = url ? url.match(regex) : null;
            return match ? match[1] : null;
        };

        const generateYouTubeThumbnailUrl = (videoId) => `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;

        const renderLists = () => {
            watchLaterListDiv.innerHTML = '';
            seenListDiv.innerHTML = '';

            const createVideoItem = (video) => {
                const videoId = getYouTubeId(video.url);
                const thumbnailUrl = videoId ? generateYouTubeThumbnailUrl(videoId) : 'https://placehold.co/320x180/1a202c/ffffff?text=No+Preview';
                return `
                    <a href="${video.url}" target="_blank" class="block rounded-lg overflow-hidden group">
                        <div class="relative">
                            <img src="${thumbnailUrl}" class="w-full h-auto object-cover">
                            <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                <p class="text-white text-center text-sm p-1">${video.title}</p>
                            </div>
                        </div>
                    </a>`;
            };

            watchLaterList.forEach(video => watchLaterListDiv.innerHTML += createVideoItem(video));
            seenList.forEach(video => seenListDiv.innerHTML += createVideoItem(video));
            
            if (watchLaterList.length === 0) watchLaterListDiv.innerHTML = '<p class="text-gray-500 col-span-full">No videos saved for later.</p>';
            if (seenList.length === 0) seenListDiv.innerHTML = '<p class="text-gray-500 col-span-full">No videos marked as seen.</p>';
        };
        
        const switchView = (view) => {
            if (view === 'lists') {
                feedView.classList.add('hidden');
                listsView.classList.remove('hidden');
                listsButton.classList.add('active');
                feedButton.classList.remove('active');
                renderLists();
            } else {
                listsView.classList.add('hidden');
                feedView.classList.remove('hidden');
                feedButton.classList.add('active');
                listsButton.classList.remove('active');
            }
        };

        feedButton.addEventListener('click', () => switchView('feed'));
        listsButton.addEventListener('click', () => switchView('lists'));

        const loadVideo = (index) => {
            if (index < feedVideoData.length) {
                const video = feedVideoData[index];
                videoTitle.textContent = video.title;
                const videoId = getYouTubeId(video.url);
                videoThumbnail.style.backgroundImage = videoId ? `url('https://img.youtube.com/vi/${videoId}/maxresdefault.jpg')` : 'none';
                watchButton.href = video.url;
                instructionText.textContent = "Swipe left or right to discover more.";
                watchButton.classList.remove('hidden');
            } else {
                videoTitle.textContent = "All Caught Up!";
                videoThumbnail.style.backgroundImage = 'none';
                videoThumbnail.style.backgroundColor = '#1f2937';
                watchButton.classList.add('hidden');
                instructionText.textContent = "Swipe up or check 'My Lists'.";
            }
        };

        const parseCSV = (text) => {
            const lines = text.split('\n').filter(line => line.trim() !== '');
            const headers = lines[0].split(',').map(header => header.trim());
            return lines.slice(1).map(line => {
                const values = line.split(',').map(value => value.trim());
                if (values.length === headers.length) {
                    return headers.reduce((obj, header, i) => ({ ...obj, [header]: values[i] }), {});
                }
                return null;
            }).filter(Boolean);
        };
        
        const loadInitialData = () => {
            // Replace this with the raw URL to your videos.csv file on GitHub
             fetch(https://raw.githubusercontent.com/harivivek22/MTC/refs/heads/main/videos.csv)
                .then(response => response.ok ? response.text() : Promise.reject('Failed to load videos.csv'))
                .then(csvText => {
                    allVideoData = parseCSV(csvText);
                    const ratedUrls = [...seenList.map(v => v.url), ...watchLaterList.map(v => v.url)];
                    feedVideoData = allVideoData.filter(video => !ratedUrls.includes(video.url));
                    videoIndex = 0;
                    loadVideo(videoIndex);
                })
                .catch(error => {
                    videoTitle.textContent = "Error Loading Videos";
                    instructionText.textContent = "Please ensure videos.csv exists and is correctly formatted. Make sure to update the URL in the code.";
                });
        };

        const onSwipeComplete = (direction) => {
            if (videoIndex >= feedVideoData.length) return;
            
            const video = feedVideoData[videoIndex];
            videoCard.style.transition = 'transform 0.5s ease-in-out';

            if (direction === 'right') {
                videoCard.style.transform = 'translateX(100vw) rotate(30deg)';
                seenLabel.style.opacity = '1';
                if (!seenList.find(v => v.url === video.url)) {
                    seenList.push(video);
                    localStorage.setItem('seenList', JSON.stringify(seenList));
                }
            } else if (direction === 'left') {
                videoCard.style.transform = 'translateX(-100vw) rotate(-30deg)';
                laterLabel.style.opacity = '1';
                if (!watchLaterList.find(v => v.url === video.url)) {
                    watchLaterList.push(video);
                    localStorage.setItem('watchLaterList', JSON.stringify(watchLaterList));
                }
            }

            setTimeout(() => {
                seenLabel.style.opacity = '0';
                laterLabel.style.opacity = '0';
                videoIndex++;
                videoCard.style.transition = 'none';
                videoCard.style.transform = 'translateX(0) rotate(0)';
                loadVideo(videoIndex);
            }, 500);
        };

        videoCard.addEventListener('touchstart', (e) => {
            if(videoIndex >= feedVideoData.length) return;
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            isSwiping = true;
            videoCard.style.transition = 'none';
        });

        videoCard.addEventListener('touchmove', (e) => {
            if (!isSwiping) return;
            currentX = e.touches[0].clientX;
            currentY = e.touches[0].clientY;
            const deltaX = currentX - startX;
            const deltaY = currentY - startY;
            videoCard.style.transform = `translateX(${deltaX}px) translateY(${deltaY}px) rotate(${deltaX / 20}deg)`;
            
            if (Math.abs(deltaY) < Math.abs(deltaX)) {
                if (deltaX > 50) { seenLabel.style.opacity = '1'; laterLabel.style.opacity = '0'; } 
                else if (deltaX < -50) { laterLabel.style.opacity = '1'; seenLabel.style.opacity = '0'; }
                else { seenLabel.style.opacity = '0'; laterLabel.style.opacity = '0'; }
            }
        });

        videoCard.addEventListener('touchend', () => {
            if (!isSwiping) return;
            isSwiping = false;
            const deltaX = currentX - startX;
            const deltaY = currentY - startY;
            const swipeThreshold = 100;
            const verticalSwipeThreshold = -100;

            if (deltaY < verticalSwipeThreshold && Math.abs(deltaX) < 50) {
                instructionText.textContent = "Reloading videos...";
                loadInitialData();
            } else if (deltaX > swipeThreshold) {
                onSwipeComplete('right');
            } else if (deltaX < -swipeThreshold) {
                onSwipeComplete('left');
            } else {
                videoCard.style.transition = 'transform 0.3s ease-in-out';
                videoCard.style.transform = 'translateX(0) rotate(0) translateY(0)';
            }
            seenLabel.style.opacity = '0';
            laterLabel.style.opacity = '0';
        });

        document.addEventListener('DOMContentLoaded', loadInitialData);
    </script>
</body>
</html>
